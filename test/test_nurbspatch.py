from openalea.plantgl.all import *

def test_tangents():
    patch = NurbsPatch(  Point4Matrix([[(0, -0.5, 0, 1), (0, -0.166667, 0, 1), (0, 0.166667, 0, 1), (0, 0.5, 0, 1)], [(0, -0.5, 0.333333, 1), (0, -0.166667, 0.333333, 1), (0, 0.166667,0.333333, 1), (0, 0.5, 0.333333, 1)], [(0, -0.5, 0.666667, 1), (0, -0.166667, 0.666667, 1), (0, 0.166667, 0.666667, 1), (0, 0.5, 0.666667, 1)], [(0, -0.5, 1, 1), (0, -0.166667, 1, 1), (0, 0.166667, 1, 1), (0, 0.5, 1, 1)]]) )


    assert (norm(patch.getUTangentAt(0,0) - Vector3(0,0,1)) < 1e-5)
    assert (norm(patch.getVTangentAt(0,0) - Vector3(0,1,0)) < 1e-5)


    patch2 = NurbsPatch(Point4Matrix([[(0, -0.5, -0.5, 1), (0, -0.166667, -0.5, 1), (0, 0.166667, -0.5, 1), (0, 0.5, -0.5, 1)],  
                                  [(0, -0.5, -0.166667, 1), (0, -0.166667, -0.166667, 1), (0, 0.166667, -0.166667, 1), (0, 0.5, -0.166667, 1)],  
                                  [(0, -0.5, 0.166667, 1), (0, -0.166667, 0.166667, 1), (0, 0.166667, 0.166667, 1), (0, 0.5, 0.166667, 1)],  
                                  [(0, -0.5, 0.5, 1), (0, -0.166667, 0.5, 1), (0, 0.166667, 0.5, 1), (0, 0.5, 0.5, 1)]]) ,  
                )                                                                                                                                                                  

    assert (norm(patch2.getUTangentAt(0,0) - Vector3(0,0,1)) < 1e-5)
    assert (norm(patch2.getVTangentAt(0,0) - Vector3(0,1,0)) < 1e-5)


    patch3 = NurbsPatch(  
             Point4Matrix([[(0, 0, 0, 1), (0, 0.333333, 0, 1), (0, 0.666667, 0, 1), (0, 1, 0, 1)],  
                               [(0, 0, 0.333333, 1), (0, 0.333333, 0.333333, 1), (0, 0.666667, 0.333333, 1), (0, 1, 0.333333, 1)],  
                               [(0, 0, 0.666667, 1), (0, 0.333333, 0.666667, 1), (0, 0.666667, 0.666667, 1), (0, 1, 0.666667, 1)],  
                               [(0, 0, 1, 1), (0, 0.333333, 1, 1), (0, 0.666667, 1, 1), (0, 1, 1, 1)]]) ,  
             )                                                                                                                                                                  

    assert (norm(patch3.getUTangentAt(0,0) - Vector3(0,0,1)) < 1e-5)
    assert (norm(patch3.getVTangentAt(0,0) - Vector3(0,1,0)) < 1e-5)

if __name__ == '__main__':
    test_tangents()